<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="description"
    content="Generate accessible, consistent OKLCH color palettes and design tokens effortlessly. A free, professional color generator for modern web designers and developers.">
  <meta name="author" content="Oathan Rex">
  <meta name="theme-color" content="#09090b">
  <title>OKLCH Color Palette Generator | Create Beautiful Design Tokens</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #09090b;
      --bg2: #18181b;
      --bg3: #27272a;
      --bg4: #3f3f46;
      --brd: #3f3f46;
      --brd2: #27272a;
      --tx: #fafafa;
      --tx2: #a1a1aa;
      --tx3: #71717a;
      --ac: #6366f1;
      --ac2: #4f46e5;
      --ok: #22c55e;
      --err: #ef4444;
      --warn: #f59e0b;
      --mono: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
      --r-sm: .25rem;
      --r-md: .375rem;
      --r-lg: .5rem;
      --r-xl: .75rem
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    @media(prefers-reduced-motion:reduce) {

      *,
      *::before,
      *::after {
        animation-duration: .01ms !important;
        transition-duration: .01ms !important
      }
    }

    html {
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.5;
      color: var(--tx);
      background: var(--bg);
      min-height: 100vh
    }

    button {
      cursor: pointer;
      background: none;
      border: none;
      font: inherit;
      color: inherit
    }

    input {
      font: inherit;
      color: inherit
    }

    a {
      color: inherit;
      text-decoration: none
    }

    .vh {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important
    }

    .skip {
      position: fixed;
      top: -100%;
      left: 1rem;
      z-index: 100;
      padding: .5rem 1rem;
      background: var(--ac);
      color: #fff;
      border-radius: var(--r-md);
      font-weight: 600;
      transition: top .15s
    }

    .skip:focus {
      top: 1rem
    }

    :focus:not(:focus-visible) {
      outline: none
    }

    :focus-visible {
      outline: 2px solid var(--ac);
      outline-offset: 2px
    }

    .app {
      max-width: 1600px;
      margin: 0 auto;
      padding: 1rem
    }

    @media(min-width:640px) {
      .app {
        padding: 1.5rem
      }
    }

    @media(min-width:1024px) {
      .app {
        padding: 2rem
      }
    }

    .hd {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid var(--brd2)
    }

    .hd__b {
      display: flex;
      align-items: center;
      gap: .75rem
    }

    .hd__l {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6, #ec4899);
      border-radius: var(--r-lg)
    }

    .hd__t {
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: -.025em
    }

    .hd__s {
      color: var(--tx3);
      font-weight: 400
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      padding: .5rem 1rem;
      font-size: .875rem;
      font-weight: 500;
      border-radius: var(--r-md);
      transition: background-color .15s, border-color .15s
    }

    .btn:disabled {
      opacity: .5;
      cursor: not-allowed
    }

    .btn--p {
      background: var(--ac);
      color: #fff;
      border: 1px solid var(--ac)
    }

    .btn--p:hover:not(:disabled) {
      background: var(--ac2);
      border-color: var(--ac2)
    }

    .btn--s {
      background: var(--bg3);
      color: var(--tx);
      border: 1px solid var(--brd)
    }

    .btn--s:hover:not(:disabled) {
      background: var(--bg4)
    }

    .btn--g {
      background: 0 0;
      color: var(--tx2);
      border: 1px solid transparent
    }

    .btn--g:hover:not(:disabled) {
      background: var(--bg3);
      color: var(--tx)
    }

    .btn--i {
      padding: .5rem
    }

    .btn svg {
      width: 16px;
      height: 16px
    }

    .main {
      display: grid;
      gap: 1.5rem
    }

    @media(min-width:1024px) {
      .main {
        grid-template-columns: 360px 1fr;
        gap: 2rem
      }
    }

    .side {
      display: flex;
      flex-direction: column;
      gap: 1.5rem
    }

    @media(min-width:1024px) {
      .side {
        position: sticky;
        top: 1.5rem;
        max-height: calc(100vh - 3rem);
        overflow-y: auto
      }
    }

    .pnl {
      background: var(--bg2);
      border: 1px solid var(--brd2);
      border-radius: var(--r-xl);
      overflow: hidden
    }

    .pnl__h {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--brd2)
    }

    .pnl__t {
      font-size: .75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .1em;
      color: var(--tx3)
    }

    .pnl__b {
      padding: 1.25rem
    }

    .cpv {
      position: relative;
      width: 100%;
      padding-top: 56.25%;
      border-radius: var(--r-lg);
      overflow: hidden;
      margin-bottom: 1.25rem
    }

    @supports(aspect-ratio:16/9) {
      .cpv {
        padding-top: 0;
        aspect-ratio: 16/9
      }
    }

    .cpv__s {
      position: absolute;
      inset: 0;
      transition: background-color .15s
    }

    .cpv__o {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, .5), transparent 60%);
      pointer-events: none
    }

    .cpv__v {
      position: absolute;
      bottom: .75rem;
      left: .75rem;
      right: .75rem;
      display: flex;
      flex-wrap: wrap;
      gap: .5rem
    }

    .cpv__b {
      display: inline-flex;
      align-items: center;
      gap: .25rem;
      padding: .25rem .5rem;
      font-family: var(--mono);
      font-size: .75rem;
      color: #fff;
      background: rgba(0, 0, 0, .6);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
      border-radius: var(--r-sm);
      border: none;
      cursor: pointer;
      transition: background-color .15s
    }

    .cpv__b:hover {
      background: rgba(0, 0, 0, .8)
    }

    .cpv__bi {
      width: 12px;
      height: 12px;
      opacity: .7
    }

    .sg {
      margin-bottom: 1.25rem
    }

    .sg:last-of-type {
      margin-bottom: 0
    }

    .sg__h {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: .5rem
    }

    .sg__l {
      font-size: .875rem;
      font-weight: 500;
      color: var(--tx2)
    }

    .sg__v {
      font-family: var(--mono);
      font-size: .875rem;
      background: var(--bg3);
      padding: .25rem .5rem;
      border-radius: var(--r-sm);
      min-width: 56px;
      text-align: center
    }

    .sg__d {
      font-size: .75rem;
      color: var(--tx3);
      margin-top: .25rem
    }

    .sg__t {
      height: 40px;
      display: flex;
      align-items: center
    }

    .si {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 10px;
      border-radius: 9999px;
      outline: none;
      cursor: pointer
    }

    .si::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid rgba(0, 0, 0, .15);
      cursor: grab;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, .1);
      transition: transform .15s
    }

    .si::-webkit-slider-thumb:hover {
      transform: scale(1.1)
    }

    .si::-webkit-slider-thumb:active {
      cursor: grabbing
    }

    .si::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid rgba(0, 0, 0, .15);
      cursor: grab
    }

    .si--l {
      background: linear-gradient(to right, #000, #fff)
    }

    .si--c {
      background: linear-gradient(to right, var(--cm, #808080), var(--cx, #f0f))
    }

    .si--h {
      background: linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00);
      background: linear-gradient(to right, oklch(.65 .15 0), oklch(.65 .15 60), oklch(.65 .15 120), oklch(.65 .15 180), oklch(.65 .15 240), oklch(.65 .15 300), oklch(.65 .15 360))
    }

    .hi {
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 1px solid var(--brd2)
    }

    .hi__l {
      display: block;
      font-size: .875rem;
      font-weight: 500;
      color: var(--tx2);
      margin-bottom: .5rem
    }

    .hi__r {
      display: flex;
      gap: .5rem
    }

    .hi__f {
      flex: 1;
      padding: .5rem .75rem;
      font-family: var(--mono);
      font-size: .875rem;
      background: var(--bg3);
      border: 1px solid var(--brd);
      border-radius: var(--r-md);
      outline: none;
      transition: border-color .15s, box-shadow .15s
    }

    .hi__f::placeholder {
      color: var(--tx3)
    }

    .hi__f:focus {
      border-color: var(--ac);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, .15)
    }

    .hi__f[aria-invalid="true"] {
      border-color: var(--err)
    }

    .hi__e {
      display: block;
      margin-top: .25rem;
      font-size: .75rem;
      color: var(--err)
    }

    .hi__e:empty {
      display: none
    }

    .hi__w {
      display: block;
      margin-top: .25rem;
      font-size: .75rem;
      color: var(--warn)
    }

    .hi__w:empty {
      display: none
    }

    .ct {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      min-width: 0
    }

    .sec {
      display: flex;
      flex-direction: column;
      gap: 1rem
    }

    .sec__t {
      font-size: .75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .1em;
      color: var(--tx3)
    }

    .ss {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 2px;
      border-radius: var(--r-xl);
      overflow: hidden
    }

    @media(max-width:640px) {
      .ss {
        grid-template-columns: repeat(5, 1fr)
      }
    }

    .sw {
      position: relative;
      padding-top: 100%;
      cursor: pointer;
      transition: transform .15s;
      border: none;
      background: none
    }

    @supports(aspect-ratio:1) {
      .sw {
        padding-top: 0;
        aspect-ratio: 1
      }
    }

    .sw:hover {
      transform: scale(1.08);
      z-index: 10
    }

    .sw:focus-visible {
      outline: 2px solid #fff;
      outline-offset: 2px;
      z-index: 20
    }

    .sw[aria-selected="true"] {
      outline: 2px solid #fff;
      outline-offset: 2px;
      z-index: 20
    }

    .sw__l {
      position: absolute;
      bottom: .5rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: .75rem;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: var(--r-sm)
    }

    .sw__l--lt {
      background: rgba(0, 0, 0, .3);
      color: #fff
    }

    .sw__l--dk {
      background: rgba(255, 255, 255, .3);
      color: rgba(0, 0, 0, .8)
    }

    .dt {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: .75rem;
      padding: 1rem;
      background: var(--bg2);
      border: 1px solid var(--brd2);
      border-radius: var(--r-lg)
    }

    .dt__s {
      grid-column: 1/-1;
      font-size: .875rem;
      color: var(--tx2);
      padding-bottom: .5rem;
      border-bottom: 1px solid var(--brd2);
      margin-bottom: .5rem
    }

    .dt__i {
      display: flex;
      flex-direction: column;
      gap: .25rem
    }

    .dt__la {
      font-size: .75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: .05em;
      color: var(--tx3)
    }

    .dt__va {
      display: flex;
      align-items: center;
      gap: .5rem;
      font-family: var(--mono);
      font-size: .875rem;
      word-break: break-all
    }

    .dt__cp {
      flex-shrink: 0;
      padding: .25rem;
      color: var(--tx3);
      border-radius: var(--r-sm);
      transition: color .15s, background-color .15s
    }

    .dt__cp:hover {
      color: var(--tx);
      background: var(--bg3)
    }

    .dt__cp[data-c="1"] {
      color: var(--ok)
    }

    .dt__cp svg {
      width: 14px;
      height: 14px
    }

    .ag {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: .75rem
    }

    @media(max-width:640px) {
      .ag {
        grid-template-columns: repeat(2, 1fr)
      }
    }

    .as {
      position: relative;
      padding-top: 50%;
      border-radius: var(--r-md);
      overflow: hidden;
      border: 1px solid var(--brd2)
    }

    @supports(aspect-ratio:2/1) {
      .as {
        padding-top: 0;
        aspect-ratio: 2/1
      }
    }

    .as__ck {
      position: absolute;
      inset: 0;
      background-color: #27272a;
      background-image: linear-gradient(45deg, #3f3f46 25%, transparent 25%), linear-gradient(-45deg, #3f3f46 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #3f3f46 75%), linear-gradient(-45deg, transparent 75%, #3f3f46 75%);
      background-size: 12px 12px;
      background-position: 0 0, 0 6px, 6px -6px, -6px 0
    }

    .as__c {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding: .5rem
    }

    .as__la {
      font-size: .75rem;
      font-weight: 600;
      padding: 2px 8px;
      background: rgba(0, 0, 0, .5);
      color: #fff;
      border-radius: var(--r-sm)
    }

    .ay {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: .75rem
    }

    .ay__i {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .75rem;
      padding: .75rem 1rem;
      background: var(--bg2);
      border: 1px solid var(--brd2);
      border-radius: var(--r-md)
    }

    .ay__inf {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0
    }

    .ay__la {
      font-size: .875rem;
      font-weight: 500
    }

    .ay__ra {
      font-family: var(--mono);
      font-size: .75rem;
      color: var(--tx3)
    }

    .ay__b {
      display: inline-flex;
      align-items: center;
      gap: .25rem;
      padding: .25rem .5rem;
      font-size: .75rem;
      font-weight: 600;
      border-radius: var(--r-sm);
      white-space: nowrap
    }

    .ay__b--p {
      background: rgba(34, 197, 94, .15);
      color: var(--ok)
    }

    .ay__b--f {
      background: rgba(239, 68, 68, .15);
      color: var(--err)
    }

    .ay__b svg {
      width: 12px;
      height: 12px
    }

    .pv {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem
    }

    .pv__c {
      padding: 1.25rem;
      border-radius: var(--r-lg);
      border: 1px solid var(--brd2)
    }

    .pv__ct {
      font-size: .75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .05em;
      margin-bottom: 1rem;
      opacity: .6
    }

    .pv__bs {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem
    }

    .pv__bt {
      padding: .5rem 1rem;
      font-size: .875rem;
      font-weight: 500;
      border-radius: var(--r-md);
      cursor: default
    }

    .pv__bt--s {
      border: none
    }

    .pv__bt--o {
      background: transparent;
      border: 2px solid currentColor
    }

    .pv__bt--g {
      background: transparent;
      border: none;
      text-decoration: underline
    }

    .pv__ty h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: .5rem
    }

    .pv__ty p {
      font-size: .875rem;
      line-height: 1.625
    }

    .ip {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem
    }

    .ip__c {
      background: var(--bg2);
      border: 1px solid var(--brd2);
      border-radius: var(--r-lg);
      overflow: hidden
    }

    .ip__g {
      height: 48px
    }

    .ip__ss {
      display: flex;
      height: 24px
    }

    .ip__st {
      flex: 1
    }

    .ip__in {
      padding: 1rem
    }

    .ip__ti {
      font-size: .875rem;
      font-weight: 600;
      margin-bottom: .25rem
    }

    .ip__de {
      font-size: .75rem;
      color: var(--tx3);
      line-height: 1.5
    }

    .ex {
      display: flex;
      flex-direction: column;
      gap: 1rem
    }

    .ex__ts {
      display: flex;
      gap: 2px;
      padding: 4px;
      background: var(--bg3);
      border-radius: var(--r-md);
      overflow-x: auto
    }

    .ex__t {
      flex: 1;
      min-width: max-content;
      padding: .5rem 1rem;
      font-size: .875rem;
      font-weight: 500;
      color: var(--tx2);
      border-radius: var(--r-sm);
      transition: color .15s, background-color .15s
    }

    .ex__t:hover:not([aria-pressed="true"]) {
      color: var(--tx)
    }

    .ex__t[aria-pressed="true"] {
      color: var(--tx);
      background: var(--bg2)
    }

    .ex__p {
      background: var(--bg);
      border: 1px solid var(--brd2);
      border-radius: var(--r-lg);
      overflow: hidden
    }

    .ex__hd {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: .75rem 1rem;
      background: var(--bg2);
      border-bottom: 1px solid var(--brd2)
    }

    .ex__fn {
      font-family: var(--mono);
      font-size: .75rem;
      color: var(--tx3)
    }

    .ex__as {
      display: flex;
      gap: .5rem
    }

    .ex__cd {
      padding: 1rem;
      max-height: 400px;
      overflow: auto
    }

    .ex__cd pre {
      margin: 0;
      font-family: var(--mono);
      font-size: .75rem;
      line-height: 1.625;
      white-space: pre
    }

    .ft {
      margin-top: 4rem;
      padding-top: 2rem;
      border-top: 1px solid var(--brd2);
      text-align: center
    }

    .ft__ls {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: .5rem;
      margin-bottom: 1rem
    }

    .ft__a {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .5rem .75rem;
      font-size: .875rem;
      color: var(--tx2);
      border-radius: var(--r-md);
      transition: color .15s, background-color .15s
    }

    .ft__a:hover {
      color: var(--tx);
      background: var(--bg3)
    }

    .ft__a svg {
      width: 18px;
      height: 18px
    }

    .ft__cr {
      font-size: .75rem;
      color: var(--tx3)
    }

    .ft__cr a {
      color: var(--tx2);
      transition: color .15s
    }

    .ft__cr a:hover {
      color: var(--tx)
    }

    .toast {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      left: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      padding: .75rem 1rem;
      font-size: .875rem;
      background: var(--bg2);
      border: 1px solid var(--brd);
      border-radius: var(--r-md);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, .1);
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transform: translateY(16px);
      transition: opacity .2s, visibility .2s, transform .2s;
      pointer-events: none
    }

    @media(min-width:640px) {
      .toast {
        left: auto;
        max-width: 320px
      }
    }

    .toast[data-v="1"] {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
      pointer-events: auto
    }

    .toast svg {
      width: 18px;
      height: 18px;
      color: var(--ok);
      flex-shrink: 0
    }

    .bw {
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
      background: rgba(239, 68, 68, .1);
      border: 1px solid var(--err);
      border-radius: var(--r-lg)
    }

    .bw h2 {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--err);
      margin-bottom: .5rem
    }

    .bw p {
      font-size: .875rem;
      color: var(--tx2);
      max-width: 50ch;
      margin: 0 auto
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px
    }

    ::-webkit-scrollbar-track {
      background: transparent
    }

    ::-webkit-scrollbar-thumb {
      background: var(--brd);
      border-radius: 9999px
    }

    * {
      scrollbar-width: thin;
      scrollbar-color: var(--brd) transparent
    }
  </style>
</head>

<body>
  <a href="#main" class="skip">Skip to main content</a>
  <div class="app">
    <header class="hd">
      <div class="hd__b">
        <div class="hd__l" aria-hidden="true"></div>
        <h1 class="hd__t">OKLCH Color Generator <span class="hd__s">/ Build Beautiful Palettes</span></h1>
      </div>
      <button type="button" class="btn btn--s" id="thTog" aria-label="Toggle preview theme">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="5" />
          <line x1="12" y1="1" x2="12" y2="3" />
          <line x1="12" y1="21" x2="12" y2="23" />
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
          <line x1="1" y1="12" x2="3" y2="12" />
          <line x1="21" y1="12" x2="23" y2="12" />
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
        </svg>
        <span id="thLbl">Preview: Light</span>
      </button>
    </header>
    <div id="bw" class="bw" role="alert" hidden>
      <h2>Browser Not Supported</h2>
      <p>It looks like your browser doesn't support the OKLCH color space yet. For the best experience, please use
        Chrome 111+, Firefox 113+, Safari 15.4+, or Edge 111+.</p>
    </div>
    <main id="main" class="main">
      <aside class="side" aria-label="Color controls">
        <div class="pnl">
          <div class="pnl__h">
            <h2 class="pnl__t">Base Color</h2>
          </div>
          <div class="pnl__b">
            <div class="cpv">
              <div id="cSw" class="cpv__s" role="img" aria-label="Current color preview"></div>
              <div class="cpv__o"></div>
              <div class="cpv__v">
                <button type="button" id="cpO" class="cpv__b" aria-label="Copy OKLCH value"><span id="oTx">oklch(0.65
                    0.15 260)</span><svg class="cpv__bi" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" aria-hidden="true">
                    <rect x="9" y="9" width="13" height="13" rx="2" />
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                  </svg></button>
                <button type="button" id="cpH" class="cpv__b" aria-label="Copy HEX value"><span
                    id="hTx">#6366F1</span><svg class="cpv__bi" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" aria-hidden="true">
                    <rect x="9" y="9" width="13" height="13" rx="2" />
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                  </svg></button>
              </div>
            </div>
            <div class="sg">
              <div class="sg__h"><label class="sg__l" for="sL">Lightness</label><output id="vL" class="sg__v"
                  for="sL">0.65</output></div>
              <div class="sg__t"><input type="range" id="sL" class="si si--l" min="0" max="1" step="0.001" value="0.65"
                  aria-describedby="dL"></div>
              <p id="dL" class="sg__d">Adjust how light or dark the color feels (0 is pure black, 1 is pure white).</p>
            </div>
            <div class="sg">
              <div class="sg__h"><label class="sg__l" for="sC">Chroma</label><output id="vC" class="sg__v"
                  for="sC">0.150</output></div>
              <div class="sg__t"><input type="range" id="sC" class="si si--c" min="0" max="0.5" step="0.001"
                  value="0.15" aria-describedby="dC"></div>
              <p id="dC" class="sg__d">Change the vibrance of your color. Closer to 0 is gray, while 0.5 is extremely
                vivid.</p>
            </div>
            <div class="sg">
              <div class="sg__h"><label class="sg__l" for="sH">Hue</label><output id="vH" class="sg__v"
                  for="sH">260</output></div>
              <div class="sg__t"><input type="range" id="sH" class="si si--h" min="0" max="360" step="0.1" value="260"
                  aria-describedby="dH"></div>
              <p id="dH" class="sg__d">Pick your base color from the 360-degree color wheel.</p>
            </div>
            <div class="hi"><label class="hi__l" for="hIn">Already have a color? Import HEX</label>
              <div class="hi__r"><input type="text" id="hIn" class="hi__f" placeholder="#6366F1" maxlength="9"
                  autocomplete="off" autocapitalize="none" spellcheck="false" aria-invalid="false"
                  aria-describedby="hErr hWrn"><button type="button" id="hCnv" class="btn btn--p">Convert</button></div>
              <span id="hErr" class="hi__e" role="alert" aria-live="polite"></span><span id="hWrn" class="hi__w"
                role="status" aria-live="polite"></span>
            </div>
          </div>
        </div>
      </aside>
      <div class="ct">
        <section class="sec" aria-labelledby="tSc">
          <h2 id="tSc" class="sec__t">Your Generated Color Scale</h2>
          <div>
            <div id="scSt" class="ss" role="listbox" aria-label="Color scale"></div>
            <div id="swDt" class="dt" aria-live="polite"></div>
          </div>
        </section>
        <section class="sec" aria-labelledby="tAl">
          <h2 id="tAl" class="sec__t">Alpha / Opacity Variants</h2>
          <div id="alGr" class="ag" role="list"></div>
        </section>
        <section class="sec" aria-labelledby="tAy">
          <h2 id="tAy" class="sec__t">Accessibility & Contrast Checker</h2>
          <div id="ayGr" class="ay" aria-live="polite"></div>
        </section>
        <section class="sec" aria-labelledby="tPv">
          <h2 id="tPv" class="sec__t">Live UI Component Preview</h2>
          <div id="pvGr" class="pv"></div>
        </section>
        <section class="sec" aria-labelledby="tIp">
          <h2 id="tIp" class="sec__t">Hue Interpolation Methods</h2>
          <div id="ipGr" class="ip"></div>
        </section>
        <section class="sec" aria-labelledby="tEx">
          <h2 id="tEx" class="sec__t">Export Your Tokens</h2>
          <div class="ex">
            <div id="exTs" class="ex__ts" role="group" aria-label="Export format">
              <button type="button" class="ex__t" aria-pressed="true" data-f="css">CSS</button>
              <button type="button" class="ex__t" aria-pressed="false" data-f="json">JSON</button>
              <button type="button" class="ex__t" aria-pressed="false" data-f="tailwind">Tailwind</button>
              <button type="button" class="ex__t" aria-pressed="false" data-f="figma">Figma</button>
            </div>
            <div id="exPn" class="ex__p" aria-label="Export code">
              <div class="ex__hd"><span id="exFn" class="ex__fn">color-tokens.css</span>
                <div class="ex__as"><button type="button" id="exCp" class="btn btn--g btn--i"
                    aria-label="Copy code"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                      aria-hidden="true">
                      <rect x="9" y="9" width="13" height="13" rx="2" />
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                    </svg></button><button type="button" id="exDl" class="btn btn--g btn--i"
                    aria-label="Download file"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                      stroke-width="2" aria-hidden="true">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                      <polyline points="7 10 12 15 17 10" />
                      <line x1="12" y1="15" x2="12" y2="3" />
                    </svg></button></div>
              </div>
              <div class="ex__cd">
                <pre><code id="exCd"></code></pre>
              </div>
            </div>
          </div>
        </section>

        <!-- SEO Use Cases and FAQ Sections -->
        <section class="sec" aria-labelledby="tUseCases">
          <h2 id="tUseCases" class="sec__t" style="margin-top: 1.5rem;">Why Use the OKLCH Color Space? (Use Cases)</h2>
          <div
            style="background: var(--bg2); border: 1px solid var(--brd2); border-radius: var(--r-xl); padding: 1.5rem; color: var(--tx2); line-height: 1.625;">
            <p style="margin-bottom: 1rem; color: var(--tx);">If you're building a modern digital product, choosing the
              right color system is crucial. The OKLCH color space solves many of the problems designers and developers
              face with traditional HEX or RGB colors by ensuring consistent perceptual lightness.</p>
            <ul style="padding-left: 1.25rem; margin-bottom: 0; display: flex; flex-direction: column; gap: 0.75rem;">
              <li><strong style="color: var(--tx);">UI/UX Design Systems:</strong> Create perfectly uniform color
                palettes where every shade has the exact same perceived lightness. No more "yellows" that look too
                bright or "blues" that look too dark compared to the rest of your palette.</li>
              <li><strong style="color: var(--tx);">Accessible Web Development:</strong> Ensure your text stays readable
                for all users. Because OKLCH keeps lightness predictable, it is much easier to guarantee WCAG contrast
                compliance dynamically.</li>
              <li><strong style="color: var(--tx);">Theming & Dark Mode:</strong> Building a dark mode switch? OKLCH
                allows you to simply invert the lightness value while keeping hue and chroma identical, resulting in
                mathematically perfect, effortless theme variations.</li>
            </ul>
          </div>
        </section>

        <section class="sec" aria-labelledby="tFaq">
          <h2 id="tFaq" class="sec__t">Frequently Asked Questions (FAQ)</h2>
          <div
            style="background: var(--bg2); border: 1px solid var(--brd2); border-radius: var(--r-xl); padding: 1.5rem; color: var(--tx2); line-height: 1.625; display: flex; flex-direction: column; gap: 1.5rem;">
            <div>
              <h3 style="color: var(--tx); font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;">What exactly is
                OKLCH?</h3>
              <p>OKLCH stands for Lightness, Chroma (intensity), and Hue (color angle). Unlike traditional color spaces,
                it is perceptually uniform. This means how a computer calculates the color matches exactly how the human
                eye actually views it.</p>
            </div>
            <div>
              <h3 style="color: var(--tx); font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;">Is OKLCH ready for
                production websites?</h3>
              <p>Yes, absolutely! It is fully natively supported in all modern browsers today, including Chrome, Edge,
                Safari, and Firefox. You can confidently start replacing your old HEX and RGB values with OKLCH in your
                CSS immediately for better accessibility and design outcomes.</p>
            </div>
            <div>
              <h3 style="color: var(--tx); font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;">How do I use this
                generator effectively?</h3>
              <p>Start by picking a base color using the hue, chroma, and lightness sliders, or simply paste a HEX code
                you already like into the import box. We will instantly generate a robust 10-step accessible color
                scale, give you ready-to-use code snippets for vanilla CSS or Tailwind, and let you preview how it will
                look on real UI elements.</p>
            </div>
          </div>
        </section>
      </div>
    </main>
    <footer class="ft">
      <nav class="ft__ls" aria-label="Author links">
        <a href="https://oathanrex.github.io" target="_blank" rel="noopener noreferrer" class="ft__a"><svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="12" cy="12" r="10" />
            <line x1="2" y1="12" x2="22" y2="12" />
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
          </svg>Portfolio</a>
        <a href="https://codepen.io/oathanrex" target="_blank" rel="noopener noreferrer" class="ft__a"><svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2" />
            <line x1="12" y1="22" x2="12" y2="15.5" />
            <polyline points="22 8.5 12 15.5 2 8.5" />
            <polyline points="2 15.5 12 8.5 22 15.5" />
            <line x1="12" y1="2" x2="12" y2="8.5" />
          </svg>CodePen</a>
        <a href="https://youtube.com/@oathanrex" target="_blank" rel="noopener noreferrer" class="ft__a"><svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path
              d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z" />
            <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02" />
          </svg>YouTube</a>
        <a href="https://oathanrex.blogspot.com" target="_blank" rel="noopener noreferrer" class="ft__a"><svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
          </svg>Blog</a>
        <a href="https://www.buymeacoffee.com/oathanrex" target="_blank" rel="noopener noreferrer" class="ft__a"><svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M18 8h1a4 4 0 0 1 0 8h-1" />
            <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z" />
            <line x1="6" y1="1" x2="6" y2="4" />
            <line x1="10" y1="1" x2="10" y2="4" />
            <line x1="14" y1="1" x2="14" y2="4" />
          </svg>Support</a>
      </nav>
      <p class="ft__cr">Built by <a href="https://oathanrex.github.io" target="_blank" rel="noopener noreferrer">Oathan
          Rex</a></p>
    </footer>
  </div>
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true" data-v="0"><svg viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
      <polyline points="20 6 9 17 4 12" />
    </svg><span id="toastTx">Copied!</span></div>
  <div id="sr" class="vh" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
    /**
     * Professional Color Laboratory v2.2
     * @author Oathan Rex
     * @license MIT
     * @see https://oathanrex.github.io
     */
    (function () {
      'use strict';

      const STEPS = Object.freeze([50, 100, 200, 300, 400, 500, 600, 700, 800, 900]);
      const SMAP = Object.freeze({ 50: { l: .97, s: .1 }, 100: { l: .94, s: .2 }, 200: { l: .88, s: .4 }, 300: { l: .8, s: .65 }, 400: { l: .7, s: .85 }, 500: { l: null, s: 1 }, 600: { l: .55, s: .95 }, 700: { l: .45, s: .85 }, 800: { l: .35, s: .7 }, 900: { l: .25, s: .5 } });
      const ALPHAS = Object.freeze([100, 75, 50, 25]);
      const WCAG = Object.freeze({ AA: 4.5, AAL: 3, AAA: 7, AAAL: 4.5 });
      const DFLT = Object.freeze({ l: .65, c: .15, h: 260 });
      const HEX_RE = /^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i;
      const OKLCH_RE = /^oklch\(\s*(?:\d+(?:\.\d+)?|\.\d+)\s+(?:\d+(?:\.\d+)?|\.\d+)\s+(?:\d+(?:\.\d+)?)(?:\s*\/\s*(?:\d+(?:\.\d+)?|\.\d+)%?)?\s*\)$/;
      const MAXC = .5, CWARN = .4, GITER = 32, GEPS = .0001, TOAST_MS = 2000, CPFB_MS = 1e3;
      const EFMT = Object.freeze({ css: { ext: 'css', mime: 'text/css' }, json: { ext: 'json', mime: 'application/json' }, tailwind: { ext: 'js', mime: 'text/javascript' }, figma: { ext: 'json', mime: 'application/json' } });
      const SKEYS = Object.freeze(['color', 'scale', 'selected', 'format', 'theme']);
      const LT = 'light', DK = 'dark';

      // Utilities
      const clamp = (v, mn, mx) => { const n = Number(v); return Number.isFinite(n) ? Math.min(Math.max(n, mn), mx) : mn };
      const round = (v, d = 3) => { const n = Number(v); if (!Number.isFinite(n)) return 0; const f = Math.pow(10, d); return Math.round(n * f) / f };
      const escHtml = s => { if (typeof s !== 'string') return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML };
      const escJs = s => typeof s === 'string' ? s.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/\n/g, '\\n').replace(/\r/g, '\\r') : '';

      function deepClone(o) {
        if (o === null || typeof o !== 'object') return o;
        try { return JSON.parse(JSON.stringify(o)) } catch (e) { console.warn('deepClone failed'); return o }
      }

      function rafDebounce(fn) {
        let id = null, last = null;
        const d = (...a) => { last = a; if (id === null) id = requestAnimationFrame(() => { id = null; const a = last; last = null; fn(...a) }) };
        d.cancel = () => { if (id !== null) { cancelAnimationFrame(id); id = null } last = null };
        return d;
      }

      function validColor(v) {
        if (typeof v !== 'string') return false;
        return OKLCH_RE.test(v) || /^#(?:[0-9A-Fa-f]{3}|[0-9A-Fa-f]{6}|[0-9A-Fa-f]{8})$/.test(v);
      }

      function setBg(el, c) { if (!el) return; if (validColor(c)) el.style.backgroundColor = c; else el.style.backgroundColor = '#888' }
      function setColor(el, c) { if (!el) return; if (validColor(c)) el.style.color = c; else el.style.color = '' }

      // Color math
      const C = {
        toOklab(l, c, h) {
          l = clamp(Number(l) || 0, 0, 1); c = Math.max(0, Number(c) || 0); h = ((Number(h) || 0) % 360 + 360) % 360;
          const r = h * Math.PI / 180;
          return { L: l, a: c * Math.cos(r), b: c * Math.sin(r) }
        },
        labToLin(L, a, b) {
          const l_ = L + .3963377774 * a + .2158037573 * b, m_ = L - .1055613458 * a - .0638541728 * b, s_ = L - .0894841775 * a - 1.291485548 * b;
          const l = l_ * l_ * l_, m = m_ * m_ * m_, s = s_ * s_ * s_;
          return { r: 4.0767416621 * l - 3.3077115913 * m + .2309699292 * s, g: -1.2684380046 * l + 2.6097574011 * m - .3413193965 * s, b: -.0041960863 * l - .7034186147 * m + 1.707614701 * s }
        },
        lin2s(x) { return x <= .0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - .055 },
        s2lin(x) { return x <= .04045 ? x / 12.92 : Math.pow((x + .055) / 1.055, 2.4) },
        toRgb(l, c, h) {
          l = clamp(Number(l) || 0, 0, 1);
          if (l <= 0) return { r: 0, g: 0, b: 0 }; if (l >= 1) return { r: 255, g: 255, b: 255 };
          const ok = this.toOklab(l, c, h), lin = this.labToLin(ok.L, ok.a, ok.b);
          return { r: Math.round(clamp(this.lin2s(lin.r), 0, 1) * 255), g: Math.round(clamp(this.lin2s(lin.g), 0, 1) * 255), b: Math.round(clamp(this.lin2s(lin.b), 0, 1) * 255) }
        },
        rgbHex(r, g, b) { const h = n => clamp(Math.round(n), 0, 255).toString(16).padStart(2, '0'); return `#${h(r)}${h(g)}${h(b)}`.toUpperCase() },
        toHex(l, c, h) { const rgb = this.toRgb(l, c, h); return this.rgbHex(rgb.r, rgb.g, rgb.b) },
        hexRgb(hex) {
          if (typeof hex !== 'string') return { r: 0, g: 0, b: 0 };
          hex = hex.replace(/^#/, '').trim().toLowerCase();
          if (!/^[0-9a-f]{3}$|^[0-9a-f]{6}$|^[0-9a-f]{8}$/.test(hex)) return { r: 0, g: 0, b: 0 };
          if (hex.length === 3) hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
          if (hex.length === 8) hex = hex.slice(0, 6);
          const n = parseInt(hex, 16);
          return { r: (n >> 16) & 255, g: (n >> 8) & 255, b: n & 255 }
        },
        rgbOklab(r, g, b) {
          r = clamp(r, 0, 255) / 255; g = clamp(g, 0, 255) / 255; b = clamp(b, 0, 255) / 255;
          const lr = this.s2lin(r), lg = this.s2lin(g), lb = this.s2lin(b);
          const l_ = Math.cbrt(.4122214708 * lr + .5363325363 * lg + .0514459929 * lb);
          const m_ = Math.cbrt(.2119034982 * lr + .6806995451 * lg + .1073969566 * lb);
          const s_ = Math.cbrt(.0883024619 * lr + .2817188376 * lg + .6299787005 * lb);
          return { L: .2104542553 * l_ + .793617785 * m_ - .0040720468 * s_, a: 1.9779984951 * l_ - 2.428592205 * m_ + .4505937099 * s_, b: .0259040371 * l_ + .7827717662 * m_ - .808675766 * s_ }
        },
        labToLch(L, a, b) { const c = Math.sqrt(a * a + b * b); let h = Math.atan2(b, a) * 180 / Math.PI; if (h < 0) h += 360; return { l: round(L, 4), c: round(c, 4), h: round(h % 360, 2) } },
        hexOklch(hex) { const rgb = this.hexRgb(hex), ok = this.rgbOklab(rgb.r, rgb.g, rgb.b); return this.labToLch(ok.L, ok.a, ok.b) },
        validHex(hex) { return HEX_RE.test(hex) },
        fmt(l, c, h, a = 1) {
          const ls = round(l, 3), cs = round(c, 3), hs = round(h, 1);
          return a < 1 ? `oklch(${ls} ${cs} ${hs} / ${round(a * 100, 0)}%)` : `oklch(${ls} ${cs} ${hs})`
        },
        inGamut(l, c, h) {
          const ok = this.toOklab(l, c, h), rgb = this.labToLin(ok.L, ok.a, ok.b);
          return rgb.r >= -GEPS && rgb.r <= 1 + GEPS && rgb.g >= -GEPS && rgb.g <= 1 + GEPS && rgb.b >= -GEPS && rgb.b <= 1 + GEPS
        },
        gamutMap(l, c, h) {
          l = clamp(l, 0, 1); h = ((Number(h) || 0) % 360 + 360) % 360;
          if (typeof c !== 'number' || !Number.isFinite(c) || c <= 0) return { l, c: 0, h };
          if (this.inGamut(l, c, h)) return { l, c, h };
          let lo = 0, hi = c, best = 0;
          for (let i = 0; i < GITER && (hi - lo) > GEPS; i++) { const m = (lo + hi) / 2; if (this.inGamut(l, m, h)) { best = m; lo = m } else hi = m }
          return { l, c: best, h }
        },
        // FIX BUG-02: correct 0.04045 threshold
        lum(r, g, b) {
          const [rs, gs, bs] = [r, g, b].map(c => { c = clamp(c, 0, 255) / 255; return c <= .04045 ? c / 12.92 : Math.pow((c + .055) / 1.055, 2.4) });
          return .2126 * rs + .7152 * gs + .0722 * bs
        },
        contrast(a, b) {
          if (!a || !b) return 1;
          const l1 = this.lum(clamp(a.r, 0, 255), clamp(a.g, 0, 255), clamp(a.b, 0, 255));
          const l2 = this.lum(clamp(b.r, 0, 255), clamp(b.g, 0, 255), clamp(b.b, 0, 255));
          return (Math.max(l1, l2) + .05) / (Math.min(l1, l2) + .05)
        },
        fg(l) { return l > .6 ? 'dk' : 'lt' }
      };

      // Scale generator
      function genScale(base) {
        const b = { l: clamp(base?.l != null ? Number(base.l) : .5, 0, 1), c: clamp(Number(base?.c) || 0, 0, MAXC), h: ((Number(base?.h) || 0) % 360 + 360) % 360 };
        const sc = {};
        for (const step of STEPS) {
          const cfg = SMAP[step]; if (!cfg) continue;
          const l = cfg.l !== null ? cfg.l : b.l, c = b.c * cfg.s, h = b.h;
          const m = C.gamutMap(l, c, h), rgb = C.toRgb(m.l, m.c, m.h), hex = C.rgbHex(rgb.r, rgb.g, rgb.b);
          sc[step] = Object.freeze({ l: m.l, c: m.c, h: m.h, rgb: Object.freeze(rgb), hex, css: C.fmt(m.l, m.c, m.h), fg: C.fg(m.l) })
        }
        return Object.freeze(sc)
      }

      // Exporters - FIX: Complete CSS exporter
      const Exp = {
        css(sc, b) {
          if (!sc) return '/* No data */';
          const L = [];
          L.push('/**', ' * Professional Color Laboratory', ` * ${new Date().toISOString()}`, ` * Base: ${C.fmt(b.l, b.c, b.h)}`, ' * Author: Oathan Rex (https://oathanrex.github.io)', ' */', '', ':root {');
          for (const s of STEPS) { const d = sc[s]; if (d) L.push(`  --color-primary-${s}: ${d.css};`) }
          L.push('', '  /* Alpha */');
          const b5 = sc[500];
          if (b5) for (const a of ALPHAS.slice(1)) L.push(`  --color-primary-${a}: ${C.fmt(b5.l, b5.c, b5.h, a / 100)};`);
          L.push('', '  /* Semantic */');
          L.push('  --color-primary: var(--color-primary-500);');
          L.push('  --color-primary-hover: var(--color-primary-600);');
          L.push('  --color-primary-active: var(--color-primary-700);');
          L.push('  --color-primary-subtle: var(--color-primary-100);');
          L.push('  --color-primary-muted: var(--color-primary-200);');
          L.push('}');
          return L.join('\n')
        },
        json(sc, b) {
          if (!sc) return '{}';
          const t = { $schema: 'https://design-tokens.github.io/community-group/format/', color: { primary: {} } };
          for (const s of STEPS) { const d = sc[s]; if (d) t.color.primary[s] = { $value: d.css, $type: 'color' } }
          return JSON.stringify(t, null, 2)
        },
        tailwind(sc, b) {
          if (!sc) return '// No data';
          const L = ['// Tailwind Color Config', '// Author: Oathan Rex', '', 'module.exports = {', '  theme: {', '    extend: {', '      colors: {', '        primary: {'];
          for (const s of STEPS) { const d = sc[s]; if (d) L.push(`          ${s}: '${escJs(d.css)}',`) }
          L.push('        },', '      },', '    },', '  },', '};');
          return L.join('\n')
        },
        figma(sc, b) {
          if (!sc) return '{}';
          const t = { primary: {} };
          for (const s of STEPS) { const d = sc[s]; if (d) t.primary[s] = { value: d.hex, type: 'color' } }
          return JSON.stringify(t, null, 2)
        }
      };

      // State - FIX BUG-07: re-entrancy guard
      const S = {
        _d: { color: deepClone(DFLT), scale: null, selected: 500, format: 'css', theme: LT },
        _subs: new Set(), _notifying: false, _pending: null,
        get(k) { if (k) { return this._d[k] } return deepClone(this._d) },
        set(u) {
          if (!u || typeof u !== 'object') return;
          if (this._notifying) { this._pending = this._pending || {}; Object.assign(this._pending, u); return }
          const ch = [];
          for (const [k, v] of Object.entries(u)) {
            if (!SKEYS.includes(k)) continue;
            if (this._d[k] !== v && JSON.stringify(this._d[k]) !== JSON.stringify(v)) {
              this._d[k] = v !== null && typeof v === 'object' ? Object.freeze(deepClone(v)) : v; ch.push(k)
            }
          }
          if (ch.length > 0) this._notify(ch)
        },
        sub(fn) { if (typeof fn === 'function') this._subs.add(fn); return () => this._subs.delete(fn) },
        clear() { this._subs.clear() },
        _notify(ch) {
          this._notifying = true;
          const st = deepClone(this._d);
          for (const fn of this._subs) try { fn(st, ch) } catch (e) { console.error('Sub error:', e) }
          this._notifying = false;
          if (this._pending) { const p = this._pending; this._pending = null; this.set(p) }
        }
      };

      // DOM refs
      const D = {}; const evCln = [];
      function initDOM() {
        D.bw = $('#bw'); D.main = $('#main');
        D.cSw = $('#cSw'); D.oTx = $('#oTx'); D.hTx = $('#hTx'); D.cpO = $('#cpO'); D.cpH = $('#cpH');
        D.sL = $('#sL'); D.vL = $('#vL'); D.sC = $('#sC'); D.vC = $('#vC'); D.sH = $('#sH'); D.vH = $('#vH');
        D.hIn = $('#hIn'); D.hCnv = $('#hCnv'); D.hErr = $('#hErr'); D.hWrn = $('#hWrn');
        D.scSt = $('#scSt'); D.swDt = $('#swDt'); D.alGr = $('#alGr'); D.ayGr = $('#ayGr');
        D.pvGr = $('#pvGr'); D.ipGr = $('#ipGr');
        D.exTs = $('#exTs'); D.exPn = $('#exPn'); D.exFn = $('#exFn'); D.exCd = $('#exCd');
        D.exCp = $('#exCp'); D.exDl = $('#exDl');
        D.thTog = $('#thTog'); D.thLbl = $('#thLbl');
        D.toast = $('#toast'); D.toastTx = $('#toastTx'); D.sr = $('#sr')
      }
      function $(s) { return document.querySelector(s) }

      // Notifications
      let toastT = null;
      function notify(msg, srMsg) {
        clearTimeout(toastT); D.toastTx.textContent = msg; D.toast.dataset.v = '1';
        toastT = setTimeout(() => D.toast.dataset.v = '0', TOAST_MS);
        if (D.sr) { D.sr.textContent = ''; requestAnimationFrame(() => D.sr.textContent = srMsg || msg) }
      }

      async function clip(text) {
        if (typeof text !== 'string' || !text.length) { notify('Nothing to copy'); return false }
        if (navigator.clipboard?.writeText) try { await navigator.clipboard.writeText(text); notify('Copied!', 'Copied to clipboard'); return true } catch (e) { }
        try {
          const ta = document.createElement('textarea'); ta.value = text; ta.setAttribute('readonly', '');
          ta.style.cssText = 'position:fixed;top:-9999px;opacity:0'; document.body.appendChild(ta);
          ta.select(); ta.setSelectionRange(0, text.length);
          const ok = document.execCommand('copy'); document.body.removeChild(ta);
          if (ok) { notify('Copied!', 'Copied to clipboard'); return true }
        } catch (e) { }
        notify('Copy failed'); return false
      }

      // SVG helpers - no innerHTML for dynamic content
      const SVG_CHECK = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><polyline points="20 6 9 17 4 12"/></svg>';
      const SVG_X = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
      const SVG_COPY = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';

      function mkBadge(pass) {
        const sp = document.createElement('span');
        sp.className = `ay__b ay__b--${pass ? 'p' : 'f'}`;
        sp.innerHTML = (pass ? SVG_CHECK : SVG_X) + ` ${pass ? 'PASS' : 'FAIL'}`;
        return sp
      }

      // Renderers
      function rPreview() {
        const color = S.get('color'); if (!color) return;
        const css = C.fmt(color.l, color.c, color.h), hex = C.toHex(color.l, color.c, color.h);
        setBg(D.cSw, css); D.oTx.textContent = css; D.hTx.textContent = hex;
        D.cSw.setAttribute('aria-label', 'Current color: ' + css);
        D.sC.style.setProperty('--cm', C.fmt(color.l, 0, color.h));
        D.sC.style.setProperty('--cx', C.fmt(color.l, MAXC, color.h))
      }

      let scBuilt = false;
      function rScale() {
        const sc = S.get('scale'), sel = S.get('selected');
        if (!sc) { D.scSt.innerHTML = ''; scBuilt = false; return }
        const ex = D.scSt.querySelectorAll('.sw');
        if (scBuilt && ex.length === STEPS.length) {
          ex.forEach((sw, i) => {
            const step = STEPS[i], d = sc[step]; if (!d) return;
            const isSel = step === sel;
            setBg(sw, d.css); sw.setAttribute('aria-selected', String(isSel));
            sw.setAttribute('tabindex', isSel ? '0' : '-1');
            sw.setAttribute('aria-label', `Step ${step}, ${d.hex}${isSel ? ', selected' : ''}`);
            const lb = sw.querySelector('.sw__l');
            if (lb) lb.className = `sw__l sw__l--${d.fg}`
          });
          D.scSt.setAttribute('aria-activedescendant', 'sw-' + sel);
          return
        }
        const fr = document.createDocumentFragment();
        for (const step of STEPS) {
          const d = sc[step]; if (!d) continue; const isSel = step === sel;
          const btn = document.createElement('button'); btn.type = 'button'; btn.className = 'sw'; btn.id = 'sw-' + step;
          setBg(btn, d.css); btn.dataset.s = step; btn.setAttribute('role', 'option');
          btn.setAttribute('aria-selected', String(isSel)); btn.setAttribute('tabindex', isSel ? '0' : '-1');
          btn.setAttribute('aria-label', `Step ${step}, ${d.hex}${isSel ? ', selected' : ''}`);
          const lb = document.createElement('span'); lb.className = `sw__l sw__l--${d.fg}`; lb.textContent = step;
          btn.appendChild(lb); fr.appendChild(btn)
        }
        D.scSt.innerHTML = ''; D.scSt.appendChild(fr);
        D.scSt.setAttribute('aria-activedescendant', 'sw-' + sel); scBuilt = true
      }

      function rDetails() {
        const sc = S.get('scale'), sel = S.get('selected');
        if (!sc || !sc[sel]) { D.swDt.innerHTML = ''; return }
        const d = sc[sel], W = { r: 255, g: 255, b: 255 }, B = { r: 0, g: 0, b: 0 };
        const cW = C.contrast(d.rgb, W), cB = C.contrast(d.rgb, B);
        const sugFg = cW >= cB ? 'white' : 'black';
        const items = [
          { l: 'Step', v: String(sel) }, { l: 'OKLCH', v: d.css, cp: 1 }, { l: 'HEX', v: d.hex, cp: 1 },
          { l: 'RGB', v: `rgb(${d.rgb.r}, ${d.rgb.g}, ${d.rgb.b})`, cp: 1 },
          { l: 'vs White', v: `${round(cW, 2)}:1` }, { l: 'vs Black', v: `${round(cB, 2)}:1` }
        ];
        const fr = document.createDocumentFragment();
        const sm = document.createElement('div'); sm.className = 'dt__s';
        sm.textContent = `Step ${sel}: ${d.hex} | Best foreground: ${sugFg}`;
        fr.appendChild(sm);
        for (const it of items) {
          const div = document.createElement('div'); div.className = 'dt__i';
          const la = document.createElement('span'); la.className = 'dt__la'; la.textContent = it.l;
          const va = document.createElement('span'); va.className = 'dt__va'; va.appendChild(document.createTextNode(it.v));
          if (it.cp) {
            const cb = document.createElement('button'); cb.type = 'button'; cb.className = 'dt__cp';
            cb.dataset.v = it.v; cb.setAttribute('aria-label', 'Copy ' + it.l); cb.innerHTML = SVG_COPY;
            va.appendChild(cb)
          }
          div.appendChild(la); div.appendChild(va); fr.appendChild(div)
        }
        D.swDt.innerHTML = ''; D.swDt.appendChild(fr)
      }

      function rAlpha() {
        const sc = S.get('scale'); if (!sc || !sc[500]) { D.alGr.innerHTML = ''; return }
        const b = sc[500]; const fr = document.createDocumentFragment();
        for (const a of ALPHAS) {
          const div = document.createElement('div'); div.className = 'as'; div.setAttribute('role', 'listitem');
          const ck = document.createElement('div'); ck.className = 'as__ck';
          const co = document.createElement('div'); co.className = 'as__c';
          setBg(co, C.fmt(b.l, b.c, b.h, a / 100));
          const la = document.createElement('span'); la.className = 'as__la'; la.textContent = a + '%';
          co.appendChild(la); div.appendChild(ck); div.appendChild(co); fr.appendChild(div)
        }
        D.alGr.innerHTML = ''; D.alGr.appendChild(fr)
      }

      function rA11y() {
        const sc = S.get('scale'), sel = S.get('selected');
        if (!sc || !sc[sel]) { D.ayGr.innerHTML = ''; return }
        const d = sc[sel], W = { r: 255, g: 255, b: 255 }, B = { r: 0, g: 0, b: 0 };
        const cW = C.contrast(d.rgb, W), cB = C.contrast(d.rgb, B);
        const checks = [
          { l: 'White (AA)', r: cW, m: WCAG.AA }, { l: 'White (Large)', r: cW, m: WCAG.AAL },
          { l: 'Black (AA)', r: cB, m: WCAG.AA }, { l: 'Black (Large)', r: cB, m: WCAG.AAL },
          { l: 'White (AAA)', r: cW, m: WCAG.AAA }, { l: 'Black (AAA)', r: cB, m: WCAG.AAA }
        ];
        const fr = document.createDocumentFragment();
        for (const ck of checks) {
          const pass = ck.r >= ck.m;
          const div = document.createElement('div'); div.className = 'ay__i';
          const inf = document.createElement('div'); inf.className = 'ay__inf';
          const la = document.createElement('span'); la.className = 'ay__la'; la.textContent = ck.l;
          const ra = document.createElement('span'); ra.className = 'ay__ra'; ra.textContent = `${round(ck.r, 2)}:1 (min ${ck.m}:1)`;
          inf.appendChild(la); inf.appendChild(ra);
          div.appendChild(inf); div.appendChild(mkBadge(pass)); fr.appendChild(div)
        }
        D.ayGr.innerHTML = ''; D.ayGr.appendChild(fr)
      }

      // FIX BUG-05: All style assignments validated
      function mkPvCard(bg, tx, title, titleC) {
        const c = document.createElement('div'); c.className = 'pv__c';
        setBg(c, bg); setColor(c, tx);
        const t = document.createElement('div'); t.className = 'pv__ct'; setColor(t, titleC); t.textContent = title;
        c.appendChild(t); return c
      }

      function rPrev() {
        const sc = S.get('scale'), th = S.get('theme');
        if (!sc) { D.pvGr.innerHTML = ''; return }
        const isL = th === LT;
        const bg = isL ? sc[50] : sc[900], tx = isL ? sc[900] : sc[50], mt = isL ? sc[600] : sc[400];
        if (!bg || !tx || !mt || !sc[500] || !sc[100] || !sc[200] || !sc[700] || !sc[800]) return;
        const fr = document.createDocumentFragment();

        // Buttons card
        const c1 = mkPvCard(bg.css, tx.css, 'Buttons', mt.css);
        const bs = document.createElement('div'); bs.className = 'pv__bs';
        const b1 = document.createElement('span'); b1.className = 'pv__bt pv__bt--s'; b1.textContent = 'Primary'; setBg(b1, sc[500].css); setColor(b1, sc[50].css);
        const b2 = document.createElement('span'); b2.className = 'pv__bt pv__bt--o'; b2.textContent = 'Secondary'; setColor(b2, sc[500].css);
        const b3 = document.createElement('span'); b3.className = 'pv__bt pv__bt--g'; b3.textContent = 'Link'; setColor(b3, sc[600].css);
        bs.appendChild(b1); bs.appendChild(b2); bs.appendChild(b3); c1.appendChild(bs); fr.appendChild(c1);

        // Typography card
        const c2 = mkPvCard(bg.css, tx.css, 'Typography', mt.css);
        const ty = document.createElement('div'); ty.className = 'pv__ty';
        const h3 = document.createElement('h3'); h3.textContent = 'Heading'; setColor(h3, isL ? sc[800].css : sc[100].css);
        const p = document.createElement('p'); p.textContent = `Body text on ${th} theme.`; setColor(p, mt.css);
        ty.appendChild(h3); ty.appendChild(p); c2.appendChild(ty); fr.appendChild(c2);

        // Brand card
        const c3 = mkPvCard(sc[500].css, sc[50].css, 'Brand', sc[200].css);
        const ty2 = document.createElement('div'); ty2.className = 'pv__ty';
        const h3b = document.createElement('h3'); h3b.textContent = 'On Primary';
        const pb = document.createElement('p'); pb.textContent = 'Content on primary brand color.'; setColor(pb, sc[100].css);
        ty2.appendChild(h3b); ty2.appendChild(pb); c3.appendChild(ty2); fr.appendChild(c3);

        // Subtle card
        const c4 = mkPvCard(isL ? sc[100].css : sc[800].css, isL ? sc[900].css : sc[100].css, 'Subtle', isL ? sc[600].css : sc[400].css);
        const ty3 = document.createElement('div'); ty3.className = 'pv__ty';
        const h3c = document.createElement('h3'); h3c.textContent = 'Card Title'; setColor(h3c, isL ? sc[800].css : sc[200].css);
        const pc = document.createElement('p'); pc.textContent = 'Subtle background area.'; setColor(pc, isL ? sc[700].css : sc[300].css);
        ty3.appendChild(h3c); ty3.appendChild(pc); c4.appendChild(ty3); fr.appendChild(c4);

        D.pvGr.innerHTML = ''; D.pvGr.appendChild(fr)
      }

      function rInterp() {
        const color = S.get('color'); if (!color) return;
        const h1 = color.h, h2 = (color.h + 180) % 360;
        const methods = [
          { n: 'shorter hue', d: 'Shortest path (default)', g: `linear-gradient(to right in oklch shorter hue,oklch(${color.l} ${color.c} ${h1}),oklch(${color.l} ${color.c} ${h2}))` },
          { n: 'longer hue', d: 'Longest path around wheel', g: `linear-gradient(to right in oklch longer hue,oklch(${color.l} ${color.c} ${h1}),oklch(${color.l} ${color.c} ${h2}))` },
          { n: 'sRGB', d: 'Standard RGB interpolation', g: `linear-gradient(to right in srgb,oklch(${color.l} ${color.c} ${h1}),oklch(${color.l} ${color.c} ${h2}))` }
        ];
        const fr = document.createDocumentFragment();
        for (const m of methods) {
          const steps = [];
          for (let i = 0; i <= 10; i++) {
            const t = i / 10; let h;
            if (m.n === 'shorter hue') { let d = h2 - h1; if (d > 180) d -= 360; if (d < -180) d += 360; h = ((h1 + d * t) % 360 + 360) % 360 }
            else if (m.n === 'longer hue') { if (Math.abs(h2 - h1) < .001) h = h1; else { let d = h2 - h1; if (d > 0 && d <= 180) d -= 360; else if (d < 0 && d >= -180) d += 360; h = ((h1 + d * t) % 360 + 360) % 360 } }
            else h = h1 + (h2 - h1) * t;
            steps.push(C.fmt(color.l, color.c, h))
          }
          const card = document.createElement('div'); card.className = 'ip__c';
          const gd = document.createElement('div'); gd.className = 'ip__g'; gd.style.background = m.g;
          const sd = document.createElement('div'); sd.className = 'ip__ss';
          for (const sc of steps) { const se = document.createElement('div'); se.className = 'ip__st'; setBg(se, sc); sd.appendChild(se) }
          const inf = document.createElement('div'); inf.className = 'ip__in';
          const ti = document.createElement('div'); ti.className = 'ip__ti'; ti.textContent = m.n;
          const de = document.createElement('div'); de.className = 'ip__de'; de.textContent = m.d;
          inf.appendChild(ti); inf.appendChild(de);
          card.appendChild(gd); card.appendChild(sd); card.appendChild(inf); fr.appendChild(card)
        }
        D.ipGr.innerHTML = ''; D.ipGr.appendChild(fr)
      }

      function rExport() {
        const sc = S.get('scale'), color = S.get('color'), fmt = S.get('format');
        if (!sc || !color) { D.exCd.textContent = '// No data'; return }
        const exp = Exp[fmt], cfg = EFMT[fmt];
        if (!exp || !cfg) { D.exCd.textContent = '// Unknown format'; return }
        D.exFn.textContent = `color-tokens.${cfg.ext}`; D.exCd.textContent = exp(sc, color);
        D.exTs.querySelectorAll('.ex__t').forEach(t => t.setAttribute('aria-pressed', String(t.dataset.f === fmt)))
      }

      // Event handlers
      const onSlider = rafDebounce(e => {
        const sl = e.target, id = sl.id; let v = parseFloat(sl.value);
        if (!Number.isFinite(v)) return;
        v = clamp(v, parseFloat(sl.min) || 0, parseFloat(sl.max) || 1);
        const color = S.get('color'); let nc;
        if (id === 'sL') { nc = { l: v, c: color.c, h: color.h }; D.vL.textContent = round(v, 2) }
        else if (id === 'sC') { nc = { l: color.l, c: v, h: color.h }; D.vC.textContent = round(v, 3) }
        else if (id === 'sH') { nc = { l: color.l, c: color.c, h: v }; D.vH.textContent = Math.round(v) }
        else return;
        if (nc) S.set({ color: nc })
      });

      function onHexConvert() {
        let hex = D.hIn.value.trim();
        if (!hex) { D.hIn.setAttribute('aria-invalid', 'false'); D.hErr.textContent = ''; D.hWrn.textContent = ''; return }
        if (!hex.startsWith('#')) hex = '#' + hex;
        if (!C.validHex(hex)) { D.hIn.setAttribute('aria-invalid', 'true'); D.hErr.textContent = 'Invalid HEX'; D.hWrn.textContent = ''; notify('Invalid HEX', 'Invalid HEX format'); return }
        D.hIn.setAttribute('aria-invalid', 'false'); D.hErr.textContent = '';
        const ok = C.hexOklch(hex);
        D.hWrn.textContent = ok.c > CWARN ? `Chroma ${round(ok.c, 3)} is high. Some steps may be gamut-mapped.` : '';
        ok.c = clamp(ok.c, 0, MAXC);
        D.sL.value = ok.l; D.vL.textContent = round(ok.l, 2);
        D.sC.value = ok.c; D.vC.textContent = round(ok.c, 3);
        D.sH.value = ok.h; D.vH.textContent = Math.round(ok.h);
        S.set({ color: ok }); notify('Converted!', 'Color converted to OKLCH')
      }

      function onScaleClick(e) {
        const sw = e.target.closest('.sw'); if (!sw) return;
        const step = parseInt(sw.dataset.s, 10);
        if (!isNaN(step) && STEPS.includes(step)) S.set({ selected: step })
      }

      function onScaleKey(e) {
        const sel = S.get('selected'), idx = STEPS.indexOf(sel); if (idx === -1) return; let ni = idx;
        switch (e.key) {
          case 'ArrowLeft': case 'ArrowUp': ni = Math.max(0, idx - 1); e.preventDefault(); break;
          case 'ArrowRight': case 'ArrowDown': ni = Math.min(STEPS.length - 1, idx + 1); e.preventDefault(); break;
          case 'Home': ni = 0; e.preventDefault(); break; case 'End': ni = STEPS.length - 1; e.preventDefault(); break;
          default: return
        }
        if (ni !== idx) { const ns = STEPS[ni]; S.set({ selected: ns }); const btn = document.getElementById('sw-' + ns); if (btn) btn.focus() }
      }

      function onDetailsCopy(e) {
        const btn = e.target.closest('.dt__cp'); if (!btn) return;
        const v = btn.dataset.v; if (!v) return;
        clip(v).then(ok => { if (ok) { btn.dataset.c = '1'; setTimeout(() => delete btn.dataset.c, CPFB_MS) } })
      }

      function onExTabClick(e) {
        const tab = e.target.closest('.ex__t'); if (!tab) return;
        const f = tab.dataset.f; if (f && EFMT[f]) S.set({ format: f })
      }

      function onDownload() {
        const sc = S.get('scale'), color = S.get('color'), fmt = S.get('format');
        if (!sc || !color) { notify('No data'); return }
        const exp = Exp[fmt], cfg = EFMT[fmt]; if (!exp || !cfg) { notify('Unknown format'); return }
        let url = null, a = null;
        try {
          const code = exp(sc, color), fn = `color-tokens.${cfg.ext}`;
          const blob = new Blob([code], { type: cfg.mime }); url = URL.createObjectURL(blob);
          a = document.createElement('a'); a.href = url; a.download = fn; a.style.display = 'none';
          document.body.appendChild(a); a.click(); notify('Downloaded ' + fn)
        } catch (e) { console.error('Download failed:', e); notify('Download failed') }
        finally { try { if (a && a.parentNode) document.body.removeChild(a) } catch (e) { } if (url) setTimeout(() => URL.revokeObjectURL(url), 1e3) }
      }

      function onThemeToggle() {
        const cur = S.get('theme'), nxt = cur === LT ? DK : LT;
        D.thLbl.textContent = nxt === DK ? 'Preview: Dark' : 'Preview: Light';
        S.set({ theme: nxt }); notify(nxt + ' preview', 'Preview theme: ' + nxt)
      }

      // State handler
      function onChange(st, ch) {
        if (ch.includes('color')) { S.set({ scale: genScale(st.color) }); rPreview(); rInterp() }
        if (ch.includes('scale')) { rScale(); rDetails(); rAlpha(); rA11y(); rPrev(); rExport() }
        if (ch.includes('selected') && !ch.includes('scale')) { rScale(); rDetails(); rA11y() }
        if (ch.includes('format') && !ch.includes('scale')) rExport();
        if (ch.includes('theme') && !ch.includes('scale')) rPrev()
      }

      function addEv(el, ev, fn, opt) { if (!el) return; el.addEventListener(ev, fn, opt); evCln.push(() => el.removeEventListener(ev, fn, opt)) }

      function bind() {
        addEv(D.sL, 'input', onSlider); addEv(D.sC, 'input', onSlider); addEv(D.sH, 'input', onSlider);
        addEv(D.hCnv, 'click', onHexConvert);
        addEv(D.hIn, 'keydown', e => { if (e.key === 'Enter') { e.preventDefault(); onHexConvert() } });
        addEv(D.hIn, 'input', () => { D.hIn.setAttribute('aria-invalid', 'false'); D.hErr.textContent = '' });
        addEv(D.cpO, 'click', () => clip(D.oTx.textContent));
        addEv(D.cpH, 'click', () => clip(D.hTx.textContent));
        addEv(D.scSt, 'click', onScaleClick); addEv(D.scSt, 'keydown', onScaleKey);
        addEv(D.swDt, 'click', onDetailsCopy);
        addEv(D.exTs, 'click', onExTabClick);
        addEv(D.exCp, 'click', () => clip(D.exCd.textContent));
        addEv(D.exDl, 'click', onDownload);
        addEv(D.thTog, 'click', onThemeToggle);
        S.sub(onChange)
      }

      function destroy() {
        onSlider.cancel?.(); clearTimeout(toastT);
        evCln.forEach(fn => { try { fn() } catch (e) { } }); evCln.length = 0;
        S.clear(); scBuilt = false
      }

      // Tests
      function runTests() {
        if (!(location.hostname === 'localhost' || location.hostname === '127.0.0.1' || location.hostname === '' || location.search.includes('test=1'))) return;
        const R = []; const t = (n, fn) => { try { fn(); R.push({ n, p: 1 }) } catch (e) { R.push({ n, p: 0, e: e.message }) } };
        const eq = (a, b, m) => { if (a !== b) throw new Error(m || `Expected ${b}, got ${a}`) };
        const ok = (c, m) => { if (!c) throw new Error(m || 'Assertion failed') };

        console.group('Tests');
        t('toRgb:black', () => { const r = C.toRgb(0, 0, 0); eq(r.r, 0); eq(r.g, 0); eq(r.b, 0) });
        t('toRgb:white', () => { const r = C.toRgb(1, 0, 0); eq(r.r, 255); eq(r.g, 255); eq(r.b, 255) });
        t('toRgb:NaN', () => { const r = C.toRgb(NaN, NaN, NaN); eq(r.r, 0); eq(r.g, 0); eq(r.b, 0) });
        t('hex roundtrip', () => {
          const rgb1 = C.hexRgb('#6366F1'), lch = C.hexOklch('#6366F1'), rgb2 = C.toRgb(lch.l, lch.c, lch.h);
          ok(Math.abs(rgb1.r - rgb2.r) <= 1, 'R'); ok(Math.abs(rgb1.g - rgb2.g) <= 1, 'G'); ok(Math.abs(rgb1.b - rgb2.b) <= 1, 'B')
        });
        t('hexRgb:6char', () => { const r = C.hexRgb('#FF8800'); eq(r.r, 255); eq(r.g, 136); eq(r.b, 0) });
        t('hexRgb:3char', () => { const r = C.hexRgb('#F80'); eq(r.r, 255); eq(r.g, 136); eq(r.b, 0) });
        t('hexRgb:8char', () => { const r = C.hexRgb('#FF880080'); eq(r.r, 255); eq(r.g, 136); eq(r.b, 0) });
        t('hexRgb:invalid', () => { const r = C.hexRgb('xyz'); eq(r.r, 0); eq(r.g, 0); eq(r.b, 0) });
        t('gamut:in', () => { const r = C.gamutMap(.5, .05, 90); ok(Math.abs(r.c - .05) < .001) });
        t('gamut:out', () => { const r = C.gamutMap(.95, .4, 120); ok(r.c < .4); ok(r.c >= 0) });
        t('gamut:zero', () => eq(C.gamutMap(.5, 0, 180).c, 0));
        t('gamut:neg', () => eq(C.gamutMap(.5, -.1, 180).c, 0));
        t('contrast:w/b', () => { const r = C.contrast({ r: 255, g: 255, b: 255 }, { r: 0, g: 0, b: 0 }); ok(Math.abs(r - 21) < .1, 'Got ' + r) });
        t('contrast:null', () => eq(C.contrast(null, null), 1));
        t('lum:monotonic', () => { ok(C.lum(10, 10, 10) < C.lum(11, 11, 11)) });
        t('scale:all steps', () => { const s = genScale({ l: .65, c: .15, h: 260 }); for (const st of STEPS) { ok(s[st], 'Missing ' + st); ok(typeof s[st].hex === 'string') } });
        t('scale:null input', () => ok(genScale(null)[500]));
        t('scale:frozen', () => { const s = genScale(DFLT); ok(Object.isFrozen(s)); ok(Object.isFrozen(s[500])) });
        t('exp.css:valid', () => { const s = genScale(DFLT), c = Exp.css(s, DFLT); ok(c.includes(':root')); ok(c.includes('--color-primary-500')); ok(c.includes('--color-primary-subtle')) });
        t('exp.json:valid', () => { const s = genScale(DFLT), j = JSON.parse(Exp.json(s, DFLT)); ok(j.color.primary[500]) });
        t('exp.tw:valid', () => { const s = genScale(DFLT), tw = Exp.tailwind(s, DFLT); ok(tw.includes('module.exports')); ok(tw.includes('primary')) });
        t('exp:null', () => { ok(Exp.css(null, {}).includes('No data')); eq(Exp.json(null, {}), '{}') });
        t('state:set/get', () => { S.set({ selected: 200 }); eq(S.get('selected'), 200); S.set({ selected: 500 }) });
        t('state:unknown key', () => { S.set({ badKey: 1 }); eq(S.get('badKey'), undefined) });
        t('clamp:normal', () => { eq(clamp(.5, 0, 1), .5); eq(clamp(-1, 0, 1), 0); eq(clamp(2, 0, 1), 1) });
        t('clamp:NaN', () => eq(clamp(NaN, 0, 1), 0));
        t('escHtml', () => ok(!escHtml('<script>').includes('<script>')));
        t('validColor:oklch', () => { ok(validColor('oklch(0.5 0.1 180)')); ok(validColor('oklch(0.5 0.1 180 / 50%)')); ok(!validColor('oklch(0.0.5 0.1 180)')); ok(!validColor('red')) });
        t('validColor:hex', () => { ok(validColor('#FF0000')); ok(validColor('#F00')); ok(validColor('#FF000080')) });
        t('validHex', () => { ok(C.validHex('#fff')); ok(C.validHex('#ffffff')); ok(!C.validHex('#gg0')); ok(!C.validHex('#ff')); ok(!C.validHex('')) });
        t('escJs', () => { eq(escJs("it's"), "it\\'s"); ok(escJs('a\\b').includes('\\\\')); eq(escJs(''), ''); eq(escJs(null), '') });
        t('exp.figma:valid', () => { const s = genScale(DFLT), f = JSON.parse(Exp.figma(s, DFLT)); ok(f.primary[500]); ok(typeof f.primary[500].value === 'string') });
        t('genScale:l0', () => { const s = genScale({ l: 0, c: 0.1, h: 260 }); eq(s[500].l, 0) });

        const passed = R.filter(r => r.p).length;
        console.log(`${passed}/${R.length} passed`);
        R.forEach(r => { if (r.p) console.log('  OK:', r.n); else console.error('  FAIL:', r.n, r.e) });
        console.groupEnd()
      }

      // Init
      function init() {
        console.log('%c Color Laboratory v2.2 ', 'background:linear-gradient(135deg,#6366f1,#ec4899);color:#fff;padding:8px 16px;border-radius:4px;font-weight:700');
        console.log('Oathan Rex | https://oathanrex.github.io');
        initDOM();
        try { if (!CSS.supports('color', 'oklch(0.5 0.1 180)')) { D.bw.hidden = false; D.main.style.opacity = '.3'; D.main.style.pointerEvents = 'none'; return } } catch (e) { D.bw.hidden = false; return }
        bind();
        S.set({ scale: genScale(S.get('color')) });
        rPreview(); rInterp();
        setTimeout(runTests, 200);
        console.log('Ready')
      }

      window.ColorLab = Object.freeze({ destroy, getState: () => S.get(), runTests });
      document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', init) : init()
    })();
  </script>
</body>

</html>